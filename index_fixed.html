<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Intranet by Sekizinci</title>
  <meta http-equiv="refresh" content="600">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg1: #071a2b; --bg2: #0c2a4a;
      --card: rgba(255, 255, 255, 0.08);
      --accent: #fce300; --text: #ffffff;
      --muted: rgba(255, 255, 255, 0.6);
      --border: rgba(255, 255, 255, 0.15);
      --success: #3ddc97; --danger: #ff4d4d;
      --info: #3498db;
    }
    body {
      margin: 0; min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: var(--text);
      padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px;
      display: flex; justify-content: center;
    }
    .wrap { width: 100%; max-width: 960px; padding-top: 20px; }
    .header { margin-bottom: 24px; padding: 0 4px; }
    .title { font-size: clamp(20px, 6vw, 28px); font-weight: 800; margin: 0; }
    .subtitle { font-size: 13px; color: var(--muted); margin-top: 5px; }

    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 16px; }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 22px; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      padding: 20px; position: relative;
    }
    .card-label {
      text-transform: capitalize; font-size: 11px; letter-spacing: 1.2px;
      color: var(--accent); font-weight: 700; margin-bottom: 12px;
      display: flex; align-items: center; gap: 8px;
    }

    .ping-summary-grid { display: flex; gap: 12px; margin-top: 5px; }
    .summary-box {
      flex: 1; padding: 15px; border-radius: 18px; border: 1px solid var(--border);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; transition: all 0.3s ease;
    }
    .summary-up { background: rgba(61, 220, 151, 0.1); border-color: rgba(61, 220, 151, 0.3); color: var(--success); }
    .summary-down { background: rgba(255, 77, 77, 0.1); border-color: rgba(255, 77, 77, 0.3); color: var(--danger); }
    .summary-val { font-size: 24px; font-weight: 800; }
    .summary-label { font-size: 10px; text-transform: uppercase; opacity: 0.8; letter-spacing: 1px; margin-top: 4px; }
    .down-list { font-size: 11px; font-weight: 700; margin-top: 5px; word-break: break-all; }

    .wifi-container { margin-top: 15px; max-height: 180px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 14px; border: 1px solid var(--border); }
    .wifi-table { width: 100%; border-collapse: collapse; font-size: 11px; }
    .wifi-table th { text-align: left; padding: 8px; color: var(--accent); border-bottom: 1px solid var(--border); position: sticky; top: 0; background: #0c2a4a; z-index: 1; }
    .wifi-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .wifi-container::-webkit-scrollbar { width: 4px; }
    .wifi-container::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

    .sensor-row { display: flex; justify-content: space-between; gap: 10px; margin-top: 10px; }
    .big-val { font-size: 42px; font-weight: 800; color: var(--text); display: flex; align-items: baseline; }
    .big-val span { font-size: 16px; color: var(--muted); margin-left: 4px; }

    .chart-box { background: rgba(0, 0, 0, 0.2); border-radius: 16px; padding: 10px; border: 1px solid var(--border); margin-top: 10px; height: 220px; }

    .btn {
      flex: 1; border: 1px solid var(--border); background: rgba(255,255,255,0.05);
      color: var(--text); padding: 12px; border-radius: 14px; font-weight: 700;
      font-size: 12px; cursor: pointer; transition: all 0.2s ease;
      text-transform: uppercase; letter-spacing: 1px;
    }
    .btn-on:hover { background: var(--success); color: #000; }
    .btn-off:hover { background: var(--danger); }

    .todo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    .todo-input-row {
      grid-column: 1 / -1; display: flex; gap: 10px;
      background: var(--card); padding: 8px; border-radius: 16px; border: 1px solid var(--border);
    }
    .todo-input-row input { flex: 1; background: transparent; border: none; color: white; padding: 10px; outline: none; font-size: 14px; }
    .add-btn { background: var(--accent); color: #000; border: none; padding: 0 20px; border-radius: 12px; font-weight: 800; cursor: pointer; }
    .todo-list { list-style: none; padding: 0; margin: 0; }
    .todo-item {
      background: rgba(255,255,255,0.03); border: 1px solid var(--border);
      padding: 10px 14px; border-radius: 12px; margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items: center;
      font-size: 13px; border-left: 4px solid var(--accent);
    }
    .todo-item.done { border-left-color: var(--success); opacity: 0.5; text-decoration: line-through; }
    .del-btn { color: var(--danger); background: none; border: none; font-size: 18px; cursor: pointer; padding-left: 10px; }

    .badge-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 20px; padding-bottom: 40px; }
    .badge { background: rgba(255, 255, 255, 0.08); padding: 6px 12px; border-radius: 12px; font-size: 11px; border: 1px solid var(--border); display: flex; align-items: center; gap: 6px; }
    .mono { font-family: ui-monospace, monospace; font-weight: 700; color: var(--accent); }
    .dot { width: 8px; height: 8px; border-radius: 50%; background: #3ddc97; }

    .traffic-stats-grid { display: flex; gap: 10px; margin-top: 10px; margin-bottom: 5px; }
    .traffic-box { flex: 1; background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 8px; border-radius: 12px; }
    .traffic-val { font-size: 16px; font-weight: 800; font-family: ui-monospace, monospace; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1 class="title">Intranet Portal by Sekizinci</h1>
      <p class="subtitle" id="live-clock">Yükleniyor...</p>
    </div>

    <div class="grid">
      <div style="display: flex; flex-direction: column; gap: 16px;">
        <div class="card">
          <div class="card-label">Vianen Saatlik Hava Tahmin Tablosu (Direct API Request to Open Meteo)</div>
          <div class="chart-box"><canvas id="weatherChart"></canvas></div>
        </div>

        <div class="card">
          <div class="card-label"><span class="dot"></span>Ağ Altyapı Özeti (API Request to Zabbix for ICMP Sensors via API GW)</div>
          <div id="ping-summary" class="ping-summary-grid">
            <div style="color:var(--muted); font-size:12px;">Veriler işleniyor...</div>
          </div>

          <div class="card-label" style="margin-top: 20px; margin-bottom: 10px;">
            <span class="dot" style="background:var(--info)"></span>WAN Uplink Trafik İzleme (Direct SSH Session - G0/5 Port)
          </div>

          <div class="traffic-stats-grid">
            <div class="traffic-box" style="border-left: 3px solid var(--success);">
              <div style="font-size:9px; color:var(--muted); text-transform:uppercase;">Giriş (In)</div>
              <div class="traffic-val" id="stat-in" style="color:var(--success);">--</div>
            </div>
            <div class="traffic-box" style="border-left: 3px solid var(--info);">
              <div style="font-size:9px; color:var(--muted); text-transform:uppercase;">Çıkış (Out)</div>
              <div class="traffic-val" id="stat-out" style="color:var(--info);">--</div>
            </div>
          </div>

          <div class="chart-box" style="height: 160px; margin-top: 10px;">
            <canvas id="trafficChart"></canvas>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-label">Çevresel Sensör Veri Takibi (SQL Query to PostgreSQL for Temperature and Humidity via API GW)</div>
        <div class="sensor-row">
          <div>
            <div style="font-size:11px; color:var(--muted)">Sıcaklık</div>
            <div class="big-val" id="db-temp">--<span>°C</span></div>
          </div>
          <div>
            <div style="font-size:11px; color:var(--muted)">Nem</div>
            <div class="big-val" id="db-hum">--<span>%</span></div>
          </div>
        </div>

        <div style="margin-top:20px; padding-top:15px; border-top:1px solid var(--border);">
          <div class="card-label">Uzaktan IoT Cihaz Yönetimi (Remote Script Execution via SSH/Paramiko for IoT Control via API GW)</div>
          <div style="display:flex; gap:10px;">
            <button class="btn btn-on" onclick="controlFan('AC')">Fan Aç</button>
            <button class="btn btn-off" onclick="controlFan('KAPAT')">Kapat</button>
          </div>
        </div>

        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border);">
          <div class="card-label">Pod Kimlik Bilgisi (Runtime Pod Identification via K3s Downward API)</div>
          <div style="font-size: 12px;">
            <span class="mono" id="pod-id" style="display:block; margin-top:4px; font-size:15px; color: #3ddc97; word-break: break-all;">__POD_NAME__</span>
          </div>

          <div class="card-label" style="margin-top:15px; font-size:12px;">Kablosuz Ağ İstemci Analizi (API Request to UniFi Controller for Active Wi-Fi Clients via API GW)</div>
          <div class="wifi-container">
            <table class="wifi-table">
              <thead>
                <tr><th>Cihaz</th><th>IP</th><th>MAC</th></tr>
              </thead>
              <tbody id="wifi-list-body">
                <tr><td colspan="3" style="text-align:center; opacity:0.5;">Yükleniyor...</td></tr>
              </tbody>
            </table>
          </div>
          <div style="font-size: 10px; color: var(--muted); margin-top:8px;" id="db-update-time">--</div>
        </div>
      </div>
    </div>

    <div class="todo-grid">
      <div class="todo-input-row">
        <input type="text" id="todoInput" placeholder="Yeni bir iş ekle..." onkeypress="if(event.key==='Enter') addTodo()">
        <button class="add-btn" onclick="addTodo()">EKLE</button>
      </div>
      <div class="card">
        <div class="card-label"><span class="dot" style="background:var(--accent)"></span> Yapılacaklar</div>
        <ul id="pendingList" class="todo-list"></ul>
      </div>
      <div class="card">
        <div class="card-label"><span class="dot" style="background:var(--success)"></span> Yapılanlar</div>
        <ul id="doneList" class="todo-list"></ul>
      </div>
    </div>

    <!-- Simple Library -->
    <div class="card" style="margin-top: 16px;">
      <div class="card-label"><span class="dot" style="background:#3498db;"></span> Kitap Ara & Ekle</div>
      <div style="display:flex; gap:10px; margin-bottom:15px;">
        <input type="text" id="bookSearchInput" placeholder="Kitap adı veya ISBN..." 
               style="flex:1; background:rgba(0,0,0,0.3); border:1px solid var(--border); color:white; padding:10px; border-radius:12px; outline:none; font-size:13px;"
               onkeypress="if(event.key==='Enter') searchBook()">
        <button onclick="searchBook()" style="background:var(--info); color:white; border:none; padding:10px 20px; border-radius:12px; font-weight:700; cursor:pointer; font-size:12px;">ARA</button>
      </div>
      <div id="searchResults" style="display:grid; gap:10px; max-height:300px; overflow-y:auto;"></div>
      
      <div class="card-label" style="margin-top:20px;"><span class="dot" style="background:#3ddc97;"></span> Kütüphanem</div>
      <div id="myLibrary" style="display:grid; gap:10px; max-height:300px; overflow-y:auto;"></div>
    </div>

    <div class="badge-row">
      <div class="badge"><span class="dot"></span> Online</div>
      <div class="badge">Gateway: <span class="mono">192.168.6.230</span></div>
      <div class="badge">Merkezi Servis Entegrasyonu: <span class="mono">REST API GW</span></div>
      <div class="badge">TZ: <span class="mono" id="geo-tz">--</span></div>
    </div>
  </div>

  <script>
    const API_BASE = "http://192.168.6.230:5000";

    // -------- TO-DO --------
    let todos = JSON.parse(localStorage.getItem('palas_tasks')) || [];
    function renderTodos() {
      const pList = document.getElementById('pendingList');
      const dList = document.getElementById('doneList');
      pList.innerHTML = ''; dList.innerHTML = '';
      todos.forEach((t, i) => {
        const li = document.createElement('li');
        li.className = `todo-item ${t.done ? 'done' : ''}`;
        li.innerHTML = `<span onclick="toggleTodo(${i})">${t.text}</span><button class="del-btn" onclick="delTodo(${i})">×</button>`;
        if (t.done) dList.appendChild(li); else pList.appendChild(li);
      });
      localStorage.setItem('palas_tasks', JSON.stringify(todos));
    }
    function addTodo() { const input = document.getElementById('todoInput'); if (input.value.trim()) { todos.push({ text: input.value, done: false }); input.value = ''; renderTodos(); } }
    function toggleTodo(i) { todos[i].done = !todos[i].done; renderTodos(); }
    function delTodo(i) { todos.splice(i, 1); renderTodos(); }
    renderTodos();

    // -------- CLOCK & FAN --------
    setInterval(() => { document.getElementById('live-clock').innerText = new Date().toLocaleString('tr-TR'); }, 1000);
    async function controlFan(a) { try { await fetch(`${API_BASE}/control/${a}`); } catch (e) {} }

    // -------- SENSOR DATA & WIFI --------
    async function fetchLabData() {
      try {
        const res = await fetch(`${API_BASE}/data`);
        const d = await res.json();
        if (d.temperature) {
          document.getElementById('db-temp').firstChild.textContent = d.temperature;
          document.getElementById('db-hum').firstChild.textContent = d.humidity;
          document.getElementById('db-update-time').innerText = "Son Kayıt: " + d.ts;
        }
      } catch (e) {}
    }

    async function fetchWifiClients() {
      try {
        const res = await fetch(`${API_BASE}/wifi`);
        const data = await res.json();
        const tbody = document.getElementById('wifi-list-body');
        if (data.error) return;
        tbody.innerHTML = data.map(c => `<tr><td style="font-weight:700;">${c.name}</td><td class="mono" style="font-size:10px;">${c.ip}</td><td style="opacity:0.5; font-size:9px;">${c.mac}</td></tr>`).join('');
      } catch (e) {}
    }

    // -------- PING SUMMARY --------
    async function fetchPingData() {
      try {
        const res = await fetch(`${API_BASE}/ping`);
        const data = await res.json();
        const total = data.length, up = data.filter(i => i.status === 'UP').length;
        const downDevices = data.filter(i => i.status !== 'UP').map(i => i.host);
        document.getElementById('ping-summary').innerHTML = `
          <div class="summary-box summary-up"><div class="summary-val">${up}/${total}</div><div class="summary-label">ONLINE</div></div>
          <div class="summary-box ${total-up > 0 ? 'summary-down' : 'summary-up'}" style="${total-up === 0 ? 'opacity: 0.4;' : ''}">
            <div class="summary-val">${total-up}</div><div class="summary-label">DOWN</div>
            <div class="down-list">${downDevices.length > 0 ? downDevices.join(', ') : 'Temiz'}</div>
          </div>`;
      } catch (e) {}
    }

    // -------- WEATHER CHART (FIXED) --------
    let weatherChart;
    async function drawWeather() {
      try {
        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=51.98&longitude=5.10&hourly=temperature_2m&timezone=Europe%2FAmsterdam');
        const d = await res.json();
        document.getElementById('geo-tz').innerText = d.timezone_abbreviation || 'CET';
        
        if (!d.hourly || !d.hourly.time || d.hourly.time.length === 0) {
          console.error('Invalid weather data received');
          return;
        }
        
        // Find the closest time to now in the API response
        const now = new Date();
        let startIndex = 0;
        let minDiff = Infinity;
        
        for (let i = 0; i < d.hourly.time.length; i++) {
          const apiTime = new Date(d.hourly.time[i]);
          const diff = Math.abs(apiTime - now);
          if (diff < minDiff) {
            minDiff = diff;
            startIndex = i;
          }
          // Stop if we're past current time
          if (apiTime > now) break;
        }
        
        // Determine how many hours to show (max 12, but adapt to available data)
        const maxHours = 12;
        const availableHours = d.hourly.time.length - startIndex;
        const hoursToShow = Math.min(maxHours, availableHours);
        
        // Extract labels and temps for the range
        const labels = d.hourly.time.slice(startIndex, startIndex + hoursToShow).map(t => {
          const timePart = t.split('T')[1].slice(0, 5);
          return timePart;
        });
        const temps = d.hourly.temperature_2m.slice(startIndex, startIndex + hoursToShow);
        
        if (weatherChart) weatherChart.destroy();
        weatherChart = new Chart(document.getElementById('weatherChart'), {
          type: 'line',
          data: { 
            labels, 
            datasets: [{ 
              label: 'Temp (°C)', 
              data: temps, 
              borderColor: '#fce300', 
              fill: true, 
              backgroundColor: 'rgba(252,227,0,0.1)', 
              tension: 0.4 
            }] 
          },
          options: { 
            responsive: true, 
            maintainAspectRatio: false, 
            plugins: { 
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.parsed.y + '°C';
                  }
                }
              }
            }, 
            scales: { 
              x: { 
                ticks: { color: 'rgba(255,255,255,0.6)', font: { size: 10 } },
                grid: { color: 'rgba(255,255,255,0.05)' }
              }, 
              y: { 
                ticks: { 
                  color: 'rgba(255,255,255,0.6)',
                  font: { size: 10 },
                  callback: function(value) {
                    return value + '°C';
                  }
                },
                grid: { color: 'rgba(255,255,255,0.05)' }
              } 
            } 
          }
        });
        
        console.log(`Weather chart: showing ${hoursToShow} hours starting from index ${startIndex}`);
      } catch(e) {
        console.error('Weather fetch error:', e);
      }
    }

    // -------- TRAFFIC CHART --------
    let trafficChart;
    const TRAFFIC_INTERVAL_MS = 5000;
    const TRAFFIC_MAX_POINTS = 20;

    function initTrafficChart() {
      const ctx = document.getElementById('trafficChart').getContext('2d');
      trafficChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            { label: 'In (Mbps)', borderColor: '#3ddc97', backgroundColor: 'rgba(61,220,151,0.1)', data: [], fill: true, tension: 0.4, pointRadius: 0 },
            { label: 'Out (Mbps)', borderColor: '#3498db', backgroundColor: 'rgba(52,152,219,0.1)', data: [], fill: true, tension: 0.4, pointRadius: 0 }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          animation: { duration: 400 },
          plugins: { legend: { display: false } },
          scales: {
            x: { ticks: { color: 'rgba(255,255,255,0.2)', font: { size: 9 } }, grid: { display: false } },
            y: { 
              beginAtZero: true,
              ticks: { color: 'rgba(255,255,255,0.2)', font: { size: 9 }, callback: v => v + ' Mb' }, 
              grid: { color: 'rgba(255,255,255,0.05)' } 
            }
          }
        }
      });
    }

    async function updateTraffic() {
      try {
        const res = await fetch(`${API_BASE}/traffic`);
        const data = await res.json();
        if (data.error) return;
        document.getElementById('stat-in').innerText = data.in_str;
        document.getElementById('stat-out').innerText = data.out_str;

        const inMbps = parseFloat((data.in_raw / 1000000).toFixed(4));
        const outMbps = parseFloat((data.out_raw / 1000000).toFixed(4));
        const now = data.ts;

        trafficChart.data.labels.push(now);
        trafficChart.data.datasets[0].data.push(inMbps);
        trafficChart.data.datasets[1].data.push(outMbps);

        if (trafficChart.data.labels.length > TRAFFIC_MAX_POINTS) {
          trafficChart.data.labels.shift();
          trafficChart.data.datasets[0].data.shift();
          trafficChart.data.datasets[1].data.shift();
        }
        trafficChart.update('none');
      } catch (e) {}
    }

    // -------- LIBRARY FUNCTIONS --------
    async function searchBook() {
      const query = document.getElementById('bookSearchInput').value.trim();
      if (!query) return;
      
      try {
        const res = await fetch(`${API_BASE}/books/search?q=${encodeURIComponent(query)}`);
        const books = await res.json();
        
        const container = document.getElementById('searchResults');
        if (books.error || books.length === 0) {
          container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--muted);">Sonuç bulunamadı</div>';
          return;
        }
        
        container.innerHTML = books.map(book => `
          <div style="display:flex; gap:12px; padding:12px; background:rgba(0,0,0,0.2); border:1px solid var(--border); border-radius:12px;">
            <img src="${book.cover_url || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2290%22%3E%3Crect fill=%22%23333%22 width=%2260%22 height=%2290%22/%3E%3C/svg%3E'}" 
                 style="width:60px; height:90px; border-radius:8px; object-fit:cover; background:rgba(255,255,255,0.1);">
            <div style="flex:1;">
              <div style="font-weight:700; font-size:13px; margin-bottom:4px;">${book.title || 'Başlık yok'}</div>
              <div style="font-size:11px; color:var(--muted); margin-bottom:8px;">${book.author || 'Yazar bilinmiyor'}</div>
              <button onclick='saveBook(${JSON.stringify(book)})' 
                      style="background:var(--accent); color:#000; border:none; padding:6px 12px; border-radius:8px; font-size:11px; font-weight:700; cursor:pointer;">
                EKLE
              </button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        console.error('Search error:', e);
      }
    }

    async function saveBook(book) {
      if (!book.isbn13) {
        alert('ISBN bulunamadı, kitap eklenemedi');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/books/save`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(book)
        });
        
        if (res.ok) {
          loadLibrary();
          alert('Kitap eklendi!');
        }
      } catch (e) {
        alert('Hata: ' + e.message);
      }
    }

    async function loadLibrary() {
      try {
        const res = await fetch(`${API_BASE}/books/list`);
        const books = await res.json();
        
        const container = document.getElementById('myLibrary');
        if (books.error || books.length === 0) {
          container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--muted);">Henüz kitap eklenmemiş</div>';
          return;
        }
        
        container.innerHTML = books.map(book => `
          <div style="display:flex; gap:12px; padding:12px; background:rgba(0,0,0,0.2); border:1px solid var(--border); border-radius:12px;">
            <img src="${book.cover_url || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2290%22%3E%3Crect fill=%22%23333%22 width=%2260%22 height=%2290%22/%3E%3C/svg%3E'}" 
                 style="width:60px; height:90px; border-radius:8px; object-fit:cover; background:rgba(255,255,255,0.1);">
            <div style="flex:1;">
              <div style="font-weight:700; font-size:13px; margin-bottom:4px;">${book.title || 'Başlık yok'}</div>
              <div style="font-size:11px; color:var(--muted);">${book.authors || 'Yazar bilinmiyor'}</div>
            </div>
          </div>
        `).join('');
      } catch (e) {
        console.error('Library load error:', e);
      }
    }

    // -------- START --------
    initTrafficChart();
    setInterval(updateTraffic, TRAFFIC_INTERVAL_MS);
    setInterval(fetchLabData, 5000);
    setInterval(fetchPingData, 30000);
    setInterval(fetchWifiClients, 60000);

    fetchLabData(); fetchWifiClients(); fetchPingData(); drawWeather(); updateTraffic();
    loadLibrary();  // Load library on page load
  </script>
</body>
</html>
